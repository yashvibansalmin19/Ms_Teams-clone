<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CONNECT - Meeting</title>
    <link rel="shortcut icon" href="/video-conference.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/style.css">

    <script>const ROOM_ID = "<%= roomId %>";</script>
    <script defer src="https://unpkg.com/peerjs@1.2.0/dist/peerjs.min.js"></script>
    <script defer src="/socket.io/socket.io.js"></script>
    <script defer src="/client.js"></script>
</head>

<body>
    <div class="meeting-container">
        <!-- Video Section -->
        <div class="video-section">
            <div id="video-grid"></div>

            <!-- Control Bar -->
            <div class="control-bar">
                <div class="controls-left">
                    <span class="meeting-time" id="meetingTime">00:00</span>
                </div>

                <div class="controls-center">
                    <button id="mute_unmute" class="control-btn" onclick="muteunmute()" title="Toggle microphone" aria-label="Toggle microphone">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <button id="video_on_off" class="control-btn" onclick="on_off()" title="Toggle camera" aria-label="Toggle camera">
                        <i class="fas fa-video"></i>
                    </button>
                    <button class="control-btn" onclick="CopyURL()" title="Copy meeting link" aria-label="Copy meeting link">
                        <i class="fas fa-link"></i>
                    </button>
                    <button id="toggleChat" class="control-btn" onclick="toggleChat()" title="Toggle chat" aria-label="Toggle chat">
                        <i class="fas fa-comment"></i>
                    </button>
                    <a href="/HomePage/" class="control-btn leave-btn" title="Leave meeting" aria-label="Leave meeting">
                        <i class="fas fa-phone-slash"></i>
                    </a>
                </div>

                <div class="controls-right">
                    <span class="participant-count" id="participantCount">
                        <i class="fas fa-user"></i> <span>1</span>
                    </span>
                </div>
            </div>
        </div>

        <!-- Chat Section -->
        <div class="chat-section" id="chatSection">
            <div class="chat-header">
                <h3><i class="fas fa-comments"></i> Chat</h3>
                <button class="close-chat-btn" onclick="toggleChat()" aria-label="Close chat">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="chat-messages" id="chatMessages">
                <ul class="messages"></ul>
            </div>

            <div class="chat-input-container">
                <input type="text" id="chat_message" placeholder="Type a message..." aria-label="Chat message">
                <button class="send-btn" onclick="sendMessage()" aria-label="Send message">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Toast notification -->
    <div class="toast" id="toast">Link copied to clipboard!</div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // Meeting timer
        let seconds = 0;
        setInterval(() => {
            seconds++;
            const mins = Math.floor(seconds / 60).toString().padStart(2, '0');
            const secs = (seconds % 60).toString().padStart(2, '0');
            document.getElementById('meetingTime').textContent = `${mins}:${secs}`;
        }, 1000);

        // Toggle chat panel
        function toggleChat() {
            const chatSection = document.getElementById('chatSection');
            chatSection.classList.toggle('open');
        }

        // Send message on button click
        function sendMessage() {
            const input = document.getElementById('chat_message');
            if (input.value.trim()) {
                const event = new KeyboardEvent('keydown', { which: 13, keyCode: 13 });
                input.dispatchEvent(event);
            }
        }
    </script>
</body>

</html>
